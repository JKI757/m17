# M17Text

Some POC/experimentation around doing text messaging and data communications using the [M17 ham radio mode](https://m17foundation.org/).

## Overview

M17 Packet Mode is defined in the [spec](https://spec.m17project.org), and messaging is one obvious application. Messaging currently is only defined over RF. There's no MMDVM, M17Gateway or reflector support for Packet Mode yet. There's no OpenRTX support, so the only way to text with M17 is with [SP5WWP's Nokia device](https://github.com/M17-Project/M17_3310-fw) or a 9600 baud capable radio with a modem, Digirig, etc. and some of the POC tools mentioned above.

If there were gateway and reflector support you could send and receive messages with anyone connected to the same reflector, rather than just the same repeater/hotspot. At that point it would be worthwhile to define routing--Tony VK3JED mentioned D-Star's ircDDB as a possible model. You could also build bridges to other messaging systems. Keep in mind that when I refer to messaging, I really mean M17 Packet Mode data. If you solve these problems for texting, you can use the infrastructure to build lots of different applications. 

The other thing necessary is application clients. It would be great if OpenRTX got a texting client so I could text with my CS7000. That's outside my area of expertise. This repo is an attempt to investigate and contribute in an area I know more about.

There are two tools and a library here:

* [./textclient/](./textclient/) contains a rudimentary network messaging client--think Droidstar but for text messages (and not nearly as nice looking).
* [./gateway/](./gateway/) contains a gateway program. 
* [./m17/](./m17/) contains the beginnings of an M17 library.

## Messaging Client

To build the client just run `go build` in the `textclient` directory. 

Example: `./textclient -server relay.kc1awv.net -callsign N1ADJ`

The program will respond with a prompt `> `. To send a message, enter `callsign: message`. Incoming messages for you will appear starting with `< `. To quit, enter `/quit`.

Sample session:
```
$ ./textclient -server relay.kc1awv.net
> N1ADJ: Hi from my other window!
>
2025-02-06 14:45:45 N0CALL>@ALL: Hi back
> /quit
```

Command line arguments:
```
Usage of ./textclient:
  -callsign string
    	User's callsign (default "N0CALL")
  -h	Print arguments
  -module string
    	Module to connect to (default "T")
  -port uint
    	Port the reflector listens on (default 17000)
  -server string
    	Reflector server
```

### Gateway

The gateway bridges between RF clients and relays/reflectors, somewhat like what `M17Gateway` does in the M17 voice world. Ideally it would sit between `MMDVMHost` and the network on a hotspot or repeater, but since I don't currently have any M17 Packet Mode-capable radios, it does something slightly different. It accepts a stream of float samples (as generated by [m17-packet-encode -f](https://github.com/M17-Project/M17_Implementations/tree/main/SP5WWP/m17-packet)) and forwards that on to a relay/reflector. 

It also does the reverse, receiving messages from a relay/reflector and encoding them as M17 samples suitable for a client like `m17-packet-decode`.

To build the gateway just run `go build` in the `gateway` directory. 

Example: `./gateway -debug -server relay.kc1awv.net <testdata/message.flt`

If you have an instance of `textclient` connected to the same relay with callsign `AB1CDE`, a message should appear in that client.

Or in the other direction, `./gateway -debug -server relay.kc1awv.net | ./m17-packet-decode` will use `m17-packet-decode` to display messages received from the reflector.

It can also do both encoding and decoding at the same time.

```
Usage of ./gateway:
  -callsign string
    	Callsign used for messages from the gateway to the reflector (default "GATEWAY")
  -debug
    	Emit debug log messages
  -h	Print arguments
  -in string
    	M17 input (default stdin)
  -log string
    	Device/file for log (default stderr)
  -module string
    	Module to connect to
  -out string
    	M17 output (default stdout)
  -port uint
    	Port the relay/reflector listens on (default 17000)
  -server string
    	Relay/reflector server
```